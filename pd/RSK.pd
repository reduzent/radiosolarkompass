#N canvas 0 43 674 649 10;
#X declare -path include;
#N canvas 132 96 477 296 INIT 0;
#X obj 16 7 declare -path include;
#X obj 17 34 loadbang;
#X msg 17 56 \; pd dsp 1;
#X connect 1 0 2 0;
#X restore 9 9 pd INIT;
#X obj 277 90 rsk_get_current_stream;
#X obj 277 113 spigot 1;
#N canvas 248 188 571 295 get_next_stream 0;
#X obj 26 38 rsk_get_next_stream;
#X obj 188 107 rsk_update_timetable;
#X obj 188 84 sel 0 1;
#X obj 26 85 spigot;
#X obj 156 62 t a a;
#X obj 188 129 sel 1 0;
#X obj 188 199 spigot;
#X obj 318 173 t a a;
#X obj 350 197 sel 0;
#X msg 350 219 RSK GET NEXT STREAM ERROR;
#X obj 350 241 s ERROR;
#X obj 26 7 inlet;
#X obj 26 252 outlet;
#X obj 188 151 rsk_get_next_stream;
#X connect 0 0 3 0;
#X connect 0 1 4 0;
#X connect 1 0 5 0;
#X connect 2 0 1 0;
#X connect 3 0 12 0;
#X connect 4 0 3 1;
#X connect 4 1 2 0;
#X connect 5 0 13 0;
#X connect 5 1 9 0;
#X connect 6 0 12 0;
#X connect 7 0 6 1;
#X connect 7 1 8 0;
#X connect 8 0 9 0;
#X connect 9 0 10 0;
#X connect 11 0 0 0;
#X connect 13 0 6 0;
#X connect 13 1 7 0;
#X restore 9 69 pd get_next_stream;
#X obj 386 536 r ERROR;
#X obj 386 558 print ERROR;
#X obj 279 13 text define \$0.upcoming;
#N canvas 0 50 346 285 store_upcoming 0;
#X obj 110 213 text set \$0.upcoming;
#X obj 155 169 loadbang;
#X msg 155 191 1e+08;
#X obj 110 187 list;
#X obj 8 12 inlet;
#X obj 8 110 text delete \$0.upcoming;
#X msg 8 82 -1;
#X obj 8 34 route BEGIN END;
#X obj 59 211 outlet;
#X obj 59 180 b;
#X connect 1 0 2 0;
#X connect 2 0 0 1;
#X connect 3 0 0 0;
#X connect 4 0 7 0;
#X connect 6 0 5 0;
#X connect 7 0 6 0;
#X connect 7 1 9 0;
#X connect 7 2 3 0;
#X connect 9 0 8 0;
#X restore 9 98 pd store_upcoming;
#N canvas 252 105 416 491 schedule_upcoming 0;
#X obj 15 24 inlet;
#X obj 15 84 text search \$0.upcoming;
#X obj 15 55 symbol leadtime;
#X obj 54 183 text get \$0.upcoming;
#X obj 54 255 * 1000;
#X text 102 255 convert seconds to milliseconds;
#X obj 54 301 delay;
#X obj 54 351 outlet;
#X obj 15 106 sel -1;
#X msg 15 133 RSK SCHEDULE UPCOMING ERROR;
#X obj 15 157 s ERROR;
#X msg 54 206 \$2;
#X obj 54 323 t b b;
#X msg 168 316 1;
#X msg 135 316 0;
#X obj 167 364 outlet;
#X obj 54 228 t a a;
#X obj 135 342 t a a;
#X obj 135 387 metro 1000;
#X obj 135 410 f;
#X obj 135 432 t a a;
#X obj 185 419 - 1;
#X obj 135 454 outlet;
#X obj 54 277 t a b;
#X connect 0 0 2 0;
#X connect 1 0 8 0;
#X connect 2 0 1 0;
#X connect 3 0 11 0;
#X connect 4 0 23 0;
#X connect 6 0 12 0;
#X connect 8 0 9 0;
#X connect 8 1 3 0;
#X connect 9 0 10 0;
#X connect 11 0 16 0;
#X connect 12 0 7 0;
#X connect 12 1 14 0;
#X connect 13 0 17 0;
#X connect 14 0 17 0;
#X connect 16 0 4 0;
#X connect 16 1 19 1;
#X connect 17 0 18 0;
#X connect 17 1 15 0;
#X connect 18 0 19 0;
#X connect 19 0 20 0;
#X connect 20 0 22 0;
#X connect 20 1 21 0;
#X connect 21 0 19 1;
#X connect 23 0 6 0;
#X connect 23 1 13 0;
#X restore 9 239 pd schedule_upcoming;
#X obj 552 83 s \$0.instance;
#X obj 9 445 hradio 33 1 0 2 \$0.instance \$0.instance empty 0 -8 0
10 -228856 -1 -1 0;
#X obj 277 188 list prepend;
#X obj 506 14 loadbang;
#X obj 371 187 r \$0.instance;
#X obj 277 215 s \$0.play;
#X obj 277 137 route url id;
#X obj 277 163 list append;
#X obj 277 62 r \$0.reconnect;
#X obj 529 106 s \$0.reconnect;
#N canvas 0 50 500 424 player 0;
#X obj 19 97 rsk_streamplayer;
#X obj 19 39 route 0;
#X obj 19 11 r \$0.play;
#X obj 19 63 unpack s f;
#X obj 128 149 list prepend 0;
#X obj 128 172 s \$0.playing;
#X obj 128 124 list append;
#X obj 269 97 rsk_streamplayer;
#X obj 269 11 r \$0.play;
#X obj 269 63 unpack s f;
#X obj 378 172 s \$0.playing;
#X obj 378 124 list append;
#X obj 378 149 list prepend 1;
#X obj 269 39 route 1;
#X obj 31 313 rsk_mixer . . . . . . . . ... . . .;
#X obj 273 250 r \$0.instance;
#X obj 31 378 outlet~;
#X obj 274 371 outlet~;
#X connect 0 0 14 0;
#X connect 0 1 14 1;
#X connect 0 2 6 0;
#X connect 1 0 3 0;
#X connect 2 0 1 0;
#X connect 3 0 0 0;
#X connect 3 1 6 1;
#X connect 4 0 5 0;
#X connect 6 0 4 0;
#X connect 7 0 14 2;
#X connect 7 1 14 3;
#X connect 7 2 11 0;
#X connect 8 0 13 0;
#X connect 9 0 7 0;
#X connect 9 1 11 1;
#X connect 11 0 12 0;
#X connect 12 0 10 0;
#X connect 13 0 9 0;
#X connect 14 0 16 0;
#X connect 14 1 17 0;
#X connect 15 0 14 4;
#X restore 9 491 pd player;
#X obj 80 517 rsk_announce;
#X obj 9 41 r \$0.preload;
#X obj 506 152 s \$0.preload;
#N canvas 392 51 450 300 prepare.next 0;
#N canvas 0 50 388 267 get.id 0;
#X obj 18 15 inlet;
#X obj 18 75 text search \$0.upcoming;
#X obj 18 130 text get \$0.upcoming;
#X obj 18 97 sel -1;
#X obj 18 46 symbol id;
#X obj 18 188 outlet;
#X msg 18 152 \$2;
#X connect 0 0 4 0;
#X connect 1 0 3 0;
#X connect 2 0 6 0;
#X connect 3 1 2 0;
#X connect 4 0 1 0;
#X connect 6 0 5 0;
#X restore 43 64 pd get.id;
#N canvas 0 50 388 267 get.url 0;
#X obj 18 15 inlet;
#X obj 18 94 text search \$0.upcoming;
#X obj 18 149 text get \$0.upcoming;
#X obj 18 116 sel -1;
#X obj 18 207 outlet;
#X obj 18 65 symbol url;
#X obj 18 37 bang;
#X msg 18 171 symbol \$2;
#X connect 0 0 6 0;
#X connect 1 0 3 0;
#X connect 2 0 7 0;
#X connect 3 1 2 0;
#X connect 5 0 1 0;
#X connect 6 0 5 0;
#X connect 7 0 4 0;
#X restore 11 86 pd get.url;
#X obj 11 38 t b b;
#X obj 11 117 pack s f;
#X obj 11 143 list prepend;
#X obj 107 98 r \$0.instance;
#X obj 107 120 == 0;
#X obj 11 169 s \$0.play;
#X obj 11 12 inlet;
#X connect 0 0 3 1;
#X connect 1 0 3 0;
#X connect 2 0 1 0;
#X connect 2 1 0 0;
#X connect 3 0 4 0;
#X connect 4 0 7 0;
#X connect 5 0 6 0;
#X connect 6 0 4 1;
#X connect 8 0 2 0;
#X restore 55 154 pd prepare.next;
#X obj 9 577 rsk_ducking;
#X obj 10 612 rsk_icecast;
#X obj 80 491 r \$0.announce;
#X msg 552 60 0;
#X obj 9 314 t b b b;
#N canvas 0 43 371 196 play.announcement 0;
#X msg 5 112 play;
#X obj 5 135 s \$0.announce;
#X obj 5 12 inlet;
#X obj 5 88 delay 2000;
#N canvas 398 71 335 210 prepare.announce 0;
#N canvas 0 50 388 267 get.city 0;
#X obj 18 15 inlet;
#X obj 18 75 text search \$0.upcoming;
#X obj 18 130 text get \$0.upcoming;
#X obj 18 97 sel -1;
#X obj 18 188 outlet;
#X obj 18 46 symbol city;
#X connect 0 0 5 0;
#X connect 1 0 3 0;
#X connect 2 0 4 0;
#X connect 3 1 2 0;
#X connect 5 0 1 0;
#X restore 57 67 pd get.city;
#N canvas 0 50 388 267 get.country 0;
#X obj 18 15 inlet;
#X obj 18 75 text search \$0.upcoming;
#X obj 18 130 text get \$0.upcoming;
#X obj 18 97 sel -1;
#X obj 18 188 outlet;
#X obj 18 46 symbol country;
#X connect 0 0 5 0;
#X connect 1 0 3 0;
#X connect 2 0 4 0;
#X connect 3 1 2 0;
#X connect 5 0 1 0;
#X restore 34 88 pd get.country;
#N canvas 0 50 388 267 get.station 0;
#X obj 18 15 inlet;
#X obj 18 75 text search \$0.upcoming;
#X obj 18 130 text get \$0.upcoming;
#X obj 18 97 sel -1;
#X obj 18 188 outlet;
#X obj 18 46 symbol station;
#X connect 0 0 5 0;
#X connect 1 0 3 0;
#X connect 2 0 4 0;
#X connect 3 1 2 0;
#X connect 5 0 1 0;
#X restore 11 111 pd get.station;
#X obj 11 146 s \$0.announce;
#X obj 11 38 t b b b;
#X obj 11 16 inlet;
#X connect 0 0 3 0;
#X connect 1 0 3 0;
#X connect 2 0 3 0;
#X connect 4 0 2 0;
#X connect 4 1 1 0;
#X connect 4 2 0 0;
#X connect 5 0 4 0;
#X restore 37 64 pd prepare.announce;
#X obj 5 34 t b b;
#X connect 0 0 1 0;
#X connect 2 0 5 0;
#X connect 3 0 0 0;
#X connect 5 0 3 0;
#X connect 5 1 4 0;
#X restore 55 343 pd play.announcement;
#N canvas 0 50 331 154 switch.instance 0;
#X obj 28 33 r \$0.instance;
#X obj 28 56 == 0;
#X obj 10 78 f;
#X obj 10 12 inlet;
#X obj 10 109 s \$0.instance;
#X connect 0 0 1 0;
#X connect 1 0 2 1;
#X connect 2 0 4 0;
#X connect 3 0 2 0;
#X restore 32 368 pd switch.instance;
#X obj 9 412 s \$0.preload;
#X obj 9 127 t b b b;
#X text 21 220 sleep until switch;
#X obj 146 262 tgl 20 0 empty empty empty 17 7 0 10 -228856 -1 -1 1
1;
#X obj 77 262 nbx 5 20 -1e+37 1e+37 0 0 empty empty empty 0 -8 0 10
-228856 -1 -1 2346 256;
#X text 169 264 <- should always be on;
#X obj 9 289 bng 20 250 50 0 empty empty empty 17 7 0 10 -228856 -1
-1;
#X text 34 291 <- force pre-mature switch;
#X obj 506 36 t b b b;
#X obj 506 129 delay 2093;
#X obj 9 391 delay 3000;
#N canvas 429 130 462 437 resume_stream 0;
#X text 106 19 instance status id;
#X obj 9 16 r \$0.playing;
#X obj 9 48 route 0 1;
#X obj 9 103 sel 0 1;
#X obj 9 175 del 6000;
#X msg 32 150 stop;
#X obj 27 202 r \$0.instance;
#X obj 9 225 f;
#X obj 9 247 sel 0 1;
#X obj 15 126 r \$0.instance;
#X obj 9 295 s \$0.reconnect;
#X obj 32 271 s \$0.preload;
#X obj 205 104 sel 0 1;
#X obj 205 176 del 6000;
#X msg 228 151 stop;
#X obj 223 203 r \$0.instance;
#X obj 205 226 f;
#X obj 211 127 r \$0.instance;
#X obj 205 296 s \$0.reconnect;
#X obj 228 272 s \$0.preload;
#X obj 205 248 sel 1 0;
#X msg 9 75 \$1;
#X msg 205 80 \$1;
#X text 10 336 If a stream is off (status=0) for more than 6 seconds
\, let's try to reload it.;
#X connect 1 0 2 0;
#X connect 2 0 21 0;
#X connect 2 1 22 0;
#X connect 3 0 4 0;
#X connect 3 1 5 0;
#X connect 4 0 7 0;
#X connect 5 0 4 0;
#X connect 6 0 7 1;
#X connect 7 0 8 0;
#X connect 8 0 10 0;
#X connect 8 1 11 0;
#X connect 9 0 5 0;
#X connect 12 0 13 0;
#X connect 12 1 14 0;
#X connect 13 0 16 0;
#X connect 14 0 13 0;
#X connect 15 0 16 1;
#X connect 16 0 20 0;
#X connect 17 0 14 0;
#X connect 20 0 18 0;
#X connect 20 1 19 0;
#X connect 21 0 3 0;
#X connect 22 0 12 0;
#X restore 277 310 pd resume_stream;
#N canvas 811 209 443 291 update_next 0;
#X text 107 14 instance status id;
#X obj 10 11 r \$0.playing;
#X obj 10 196 rsk_status_next;
#X obj 10 92 route;
#X obj 42 64 == 0;
#X obj 42 42 r \$0.instance;
#X obj 10 136 route 1;
#X text 51 92 <- select upcoming instance;
#X text 69 137 <- only when we receive something;
#X text 127 197 <- then update 'next' display;
#X text 14 171 <id>;
#X floatatom 70 173 5 0 0 0 - - -, f 5;
#X connect 1 0 3 0;
#X connect 3 0 6 0;
#X connect 4 0 3 1;
#X connect 5 0 4 0;
#X connect 6 0 2 0;
#X connect 11 0 2 0;
#X restore 277 334 pd update_next;
#N canvas 640 161 819 340 update_onair 0;
#X text 171 33 instance status id;
#X obj 74 30 r \$0.playing;
#X obj 74 111 route;
#X obj 106 83 == 0;
#X obj 106 61 r \$0.instance;
#X obj 74 137 route 1;
#X text 115 111 <- select upcoming instance;
#X text 133 138 <- only when we receive something;
#X obj 46 268 rsk_status_onair;
#X obj 14 167 f;
#X text 50 167 id of upcoming instance;
#X obj 14 8 r \$0.instance;
#X text 119 9 <- update when we switch;
#X obj 14 41 b;
#X text 170 266 <- then update 'onair' display;
#X obj 14 189 sel 0;
#X obj 501 47 r \$0.playing;
#X obj 501 128 route;
#X obj 533 78 r \$0.instance;
#X obj 501 154 route 1;
#X text 467 13 Set onair to current station at init;
#X obj 501 178 spigot 1;
#X obj 501 200 t a b;
#X msg 583 182 0;
#X text 623 187 only once (at startup);
#X connect 1 0 2 0;
#X connect 2 0 5 0;
#X connect 3 0 2 1;
#X connect 4 0 3 0;
#X connect 5 0 9 1;
#X connect 9 0 15 0;
#X connect 11 0 13 0;
#X connect 13 0 9 0;
#X connect 15 1 8 0;
#X connect 16 0 17 0;
#X connect 17 0 19 0;
#X connect 18 0 17 1;
#X connect 19 0 21 0;
#X connect 21 0 22 0;
#X connect 22 0 8 0;
#X connect 22 1 23 0;
#X connect 23 0 21 1;
#X restore 277 359 pd update_onair;
#N canvas 259 95 416 160 i_am_alive 0;
#X obj 23 11 loadbang;
#X obj 23 33 metro 10000;
#X obj 23 89 rsk_status_online;
#X msg 23 61 0;
#X connect 0 0 1 0;
#X connect 1 0 3 0;
#X connect 3 0 2 0;
#X restore 277 383 pd i_am_alive;
#N canvas 433 231 428 108 try_counter 0;
#X obj 11 8 r \$0.play;
#X text 81 9 instance url id;
#X msg 11 35 \$3;
#X obj 11 61 rsk_try_counter;
#X connect 0 0 2 0;
#X connect 2 0 3 0;
#X restore 277 406 pd try_counter;
#N canvas 430 221 428 108 play_counter 0;
#X msg 11 35 \$3;
#X text 108 11 instance status id;
#X obj 11 8 r \$0.playing;
#X obj 11 61 rsk_play_counter;
#X connect 0 0 3 0;
#X connect 2 0 0 0;
#X restore 277 430 pd play_counter;
#X obj 294 518 r DEBUG;
#X obj 294 565 print DEBUG;
#X obj 294 540 spigot;
#X obj 345 540 tgl 17 0 empty empty empty 17 7 0 10 -262144 -1 -1 0
1;
#X text 474 619 RSK \, 2017 \, Roman Haefeli;
#X connect 1 0 2 0;
#X connect 1 1 2 1;
#X connect 2 0 15 0;
#X connect 3 0 7 0;
#X connect 4 0 5 0;
#X connect 7 0 32 0;
#X connect 8 0 37 0;
#X connect 8 1 35 0;
#X connect 8 2 34 0;
#X connect 11 0 14 0;
#X connect 12 0 39 0;
#X connect 13 0 11 1;
#X connect 15 0 16 0;
#X connect 15 1 16 1;
#X connect 16 0 11 0;
#X connect 17 0 1 0;
#X connect 19 0 24 0;
#X connect 19 1 24 1;
#X connect 20 0 24 2;
#X connect 20 1 24 3;
#X connect 21 0 3 0;
#X connect 24 0 25 0;
#X connect 24 1 25 1;
#X connect 26 0 20 0;
#X connect 27 0 9 0;
#X connect 28 0 41 0;
#X connect 28 1 30 0;
#X connect 28 2 29 0;
#X connect 32 0 8 0;
#X connect 32 2 23 0;
#X connect 37 0 28 0;
#X connect 39 0 40 0;
#X connect 39 1 18 0;
#X connect 39 2 27 0;
#X connect 40 0 22 0;
#X connect 41 0 31 0;
#X connect 48 0 50 0;
#X connect 50 0 49 0;
#X connect 51 0 50 1;
